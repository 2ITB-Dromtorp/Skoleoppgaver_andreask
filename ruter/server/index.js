console.log("Node server started");const path=require("path"),http=require("http"),express=require("express"),cors=require("cors"),IP=process.env.HOST||"0.0.0.0",PORT=process.env.PORT||80;function checkValuePresent(e){return null!=e}function checkValueType(e,t){let s;return!(s="array"===t?"object"!=typeof e||!1===Array.isArray(e):"object"===t?"object"!=typeof e||!0===Array.isArray(e):typeof e!==t)}function checkValueFull(e,t){return!1!==checkValuePresent(e)&&!1!==checkValueType(e,t)}function checkRequestValuePresent(e,t,s){return void 0===t?(e.status(400).send(JSON.stringify({unexpected:!0,message:s+" is undefined."})),!1):null!==t||(e.status(400).send(JSON.stringify({unexpected:!0,message:s+" is null."})),!1)}function checkRequestValueType(e,t,s,r){let n;return!(n="array"===r?"object"!=typeof t||!1===Array.isArray(t):"object"===r?"object"!=typeof t||!0===Array.isArray(t):typeof t!==r)||(e.status(400).send(JSON.stringify({unexpected:!0,message:s+` isn't of type ${r}.`})),!1)}function checkRequestValueFull(e,t,s,r){return!1!==checkRequestValuePresent(e,t,s)&&!1!==checkRequestValueType(e,t,s,r)}const app=express(),server=http.createServer(app),API_URL_EXTENSION=(server.listen(PORT,IP,()=>{var e=server.address(),e=`http://${e.address}:`+e.port;console.log("Node server listening to: "+e)}),"/api");function getAPIURL(e){return API_URL_EXTENSION+e}const APIURLS=[],ipRequests=(app.use(cors()),app.use("/",express.static(path.join(__dirname,"build"))),app.use(express.json({limit:"5mb"})),{});app.use((e,s,t)=>{var r=e.socket.remoteAddress;let n=ipRequests[r];void 0===n&&(n={ip:r,requests:{content:[],api:[]}},ipRequests[r]=n);r=APIURLS.includes(e.path);let u,a;!0===r?(u="api",a=3e3):!1===r&&(u="content",a=1e3);const i=n.requests[u],p=Date.now();r=()=>{i.push({url:e.url,date:p}),t()};if(0<i.length){let t=0;for(let e=0;e<i.length;e++){var c=i[e];p-c.date<=6e4&&(t+=1)}t<=a?r():s.status(429).send(JSON.stringify({unexpected:!0,message:"Too many requests."}))}else r()}),app.get("/",(e,t)=>{t.status(200).sendFile(path.join(__dirname,"build","index.html"))}),app.get("*",(e,t)=>{t.status(200).sendFile(path.join(__dirname,"build","index.html"))});